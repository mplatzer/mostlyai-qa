{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Synthetic Data - Quality Assurance \ud83d\udd0e","text":"<p>Documentation | Sample Reports | Technical White Paper</p> <p>Assess the fidelity and novelty of synthetic samples with respect to original samples:</p> <ol> <li>calculate a rich set of accuracy, similarity and distance metrics</li> <li>visualize statistics for easy comparison to training and holdout samples</li> <li>generate a standalone, easy-to-share, easy-to-read HTML summary report</li> </ol> <p>...all with a few lines of Python code \ud83d\udca5.</p>"},{"location":"#installation","title":"Installation","text":"<p>The latest release of <code>mostlyai-qa</code> can be installed via pip:</p> <pre><code>pip install -U mostlyai-qa\n</code></pre>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code>import pandas as pd\nimport webbrowser\nfrom mostlyai import qa\n\n# fetch original + synthetic data\nbase_url = \"https://github.com/mostly-ai/mostlyai-qa/raw/refs/heads/main/examples/quick-start\"\nsyn = pd.read_csv(f\"{base_url}/census2k-syn_mostly.csv.gz\")\n# syn = pd.read_csv(f'{base_url}/census2k-syn_flip30.csv.gz') # a 30% perturbation of trn\ntrn = pd.read_csv(f\"{base_url}/census2k-trn.csv.gz\")\nhol = pd.read_csv(f\"{base_url}/census2k-hol.csv.gz\")\n\n# runs for ~30secs\nreport_path, metrics = qa.report(\n    syn_tgt_data=syn,\n    trn_tgt_data=trn,\n    hol_tgt_data=hol,\n)\n\n# pretty print metrics\nprint(metrics.model_dump_json(indent=4))\n\n# open up HTML report in new browser window\nwebbrowser.open(f\"file://{report_path.absolute()}\")\n</code></pre>"},{"location":"#basic-usage","title":"Basic Usage","text":"<pre><code>from mostlyai import qa\n\n# analyze single-table data\nreport_path, metrics = qa.report(\n    syn_tgt_data = synthetic_df,\n    trn_tgt_data = training_df,\n    hol_tgt_data = holdout_df,  # optional\n)\n\n# analyze sequential data\nreport_path, metrics = qa.report(\n    syn_tgt_data = synthetic_df,\n    trn_tgt_data = training_df,\n    hol_tgt_data = holdout_df,  # optional\n    tgt_context_key = \"user_id\",\n)\n\n# analyze sequential data with context\nreport_path, metrics = qa.report(\n    syn_tgt_data = synthetic_df,\n    trn_tgt_data = training_df,\n    hol_tgt_data = holdout_df,  # optional\n    syn_ctx_data = synthetic_context_df,\n    trn_ctx_data = training_context_df,\n    hol_ctx_data = holdout_context_df,  # optional\n    ctx_primary_key = \"id\",\n    tgt_context_key = \"user_id\",\n)\n</code></pre>"},{"location":"#sample-reports","title":"Sample Reports","text":"<ul> <li>Baseball Players (Flat Data)</li> <li>Baseball Seasons (Sequential Data)</li> </ul>"},{"location":"#citation","title":"Citation","text":"<p>Please consider citing our project if you find it useful:</p> <pre><code>@software{mostlyai-qa,\n    author = {{MOSTLY AI}},\n    title = {{MOSTLY AI - Quality Assurance}},\n    url = {https://github.com/mostly-ai/mostlyai-qa},\n    year = {2024}\n}\n</code></pre>"},{"location":"api/","title":"API Definitions","text":""},{"location":"api/#mostlyai.qa.report","title":"mostlyai.qa.report","text":""},{"location":"api/#mostlyai.qa.report.report","title":"report","text":"<pre><code>report(*, syn_tgt_data, trn_tgt_data, hol_tgt_data=None, syn_ctx_data=None, trn_ctx_data=None, hol_ctx_data=None, ctx_primary_key=None, tgt_context_key=None, report_path='model-report.html', report_title='Model Report', report_subtitle='', report_credits=REPORT_CREDITS, report_extra_info='', max_sample_size_accuracy=None, max_sample_size_embeddings=None, statistics_path=None, update_progress=None)\n</code></pre> <p>Generate HTML report and metrics for assessing synthetic data quality.</p> <p>Compares synthetic data samples with original training samples in terms of accuracy, similarity and distances. Provide holdout samples to calculate reference values for similarity and distances (recommended).</p> <p>If synthetic data has been generated conditionally on a context dataset, provide the context data as well. This will allow for bivariate accuracy metrics between context and target to be calculated.</p> <p>If the data represents sequential data, provide the <code>tgt_context_key</code> to set the groupby column for the target data.</p> <p>Customize the report with the <code>report_title</code>, <code>report_subtitle</code>, <code>report_credits</code>, and <code>report_extra_info</code>.</p> <p>Limit the compute time used by setting <code>max_sample_size_accuracy</code> and <code>max_sample_size_embeddings</code>.</p> <p>Parameters:</p> Name Type Description Default <code>syn_tgt_data</code> <code>DataFrame</code> <p>Synthetic samples</p> required <code>trn_tgt_data</code> <code>DataFrame</code> <p>Training samples</p> required <code>hol_tgt_data</code> <code>DataFrame | None</code> <p>Holdout samples</p> <code>None</code> <code>syn_ctx_data</code> <code>DataFrame | None</code> <p>Synthetic context samples</p> <code>None</code> <code>trn_ctx_data</code> <code>DataFrame | None</code> <p>Training context samples</p> <code>None</code> <code>hol_ctx_data</code> <code>DataFrame | None</code> <p>Holdout context samples</p> <code>None</code> <code>ctx_primary_key</code> <code>str | None</code> <p>Column within the context data that contains the primary key</p> <code>None</code> <code>tgt_context_key</code> <code>str | None</code> <p>Column within the target data that contains the key to link to the context</p> <code>None</code> <code>report_path</code> <code>str | Path | None</code> <p>Path of where to store the HTML report</p> <code>'model-report.html'</code> <code>report_title</code> <code>str</code> <p>Title of the HTML report</p> <code>'Model Report'</code> <code>report_subtitle</code> <code>str</code> <p>Subtitle of the HTML report</p> <code>''</code> <code>report_credits</code> <code>str</code> <p>Credits of the HTML report</p> <code>REPORT_CREDITS</code> <code>report_extra_info</code> <code>str</code> <p>Extra details to be included to the HTML report</p> <code>''</code> <code>max_sample_size_accuracy</code> <code>int | None</code> <p>Max sample size for accuracy</p> <code>None</code> <code>max_sample_size_embeddings</code> <code>int | None</code> <p>Max sample size for embeddings (similarity &amp; distances)</p> <code>None</code> <code>statistics_path</code> <code>str | Path | None</code> <p>Path of where to store the statistics to be used by <code>report_from_statistics</code></p> <code>None</code> <code>update_progress</code> <code>ProgressCallback | None</code> <p>A custom progress callback</p> <code>None</code> <p>Returns:</p> Type Description <code>Path</code> <p>Path to the generated HTML report</p> <code>Metrics | None</code> <p>Metrics instance with accuracy, similarity, and distances metrics</p>"},{"location":"examples/","title":"Usage Examples","text":""},{"location":"examples/#baseball-players-flat-data","title":"Baseball Players (Flat Data)","text":""},{"location":"examples/#case-1-players-table-only","title":"Case 1: Players Table only","text":"<pre><code>import pandas as pd\nimport webbrowser\nfrom mostlyai.qa import report\n\nrepo = \"https://github.com/mostly-ai/mostlyai-qa\"\npath = \"/raw/refs/heads/main/examples/baseball-players\"\n\nreport_path, metrics = report(\n    syn_tgt_data=pd.read_parquet(f\"{repo}/{path}/synthetic-target.pqt\"),\n    trn_tgt_data=pd.read_parquet(f\"{repo}/{path}/training-target.pqt\"),\n    hol_tgt_data=pd.read_parquet(f\"{repo}/{path}/holdout-target.pqt\"),\n    report_subtitle=\" for Baseball Players\",\n    report_path=\"baseball-players.html\",\n)\nprint(metrics.model_dump_json(indent=4))\n\nwebbrowser.open(f\"file://{report_path.absolute()}\")\n</code></pre> <p>\ud83d\udc49 HTML Report</p>"},{"location":"examples/#case-2-players-table-with-context","title":"Case 2: Players Table with Context","text":"<p><pre><code>import pandas as pd\nimport webbrowser\nfrom mostlyai.qa import report\n\nrepo = \"https://github.com/mostly-ai/mostlyai-qa\"\npath = \"/raw/refs/heads/main/examples/baseball-players\"\n\nreport_path, metrics = report(\n    syn_tgt_data=pd.read_parquet(f\"{repo}/{path}/synthetic-target.pqt\"),\n    syn_ctx_data=pd.read_parquet(f\"{repo}/{path}/synthetic-context.pqt\"),\n    trn_tgt_data=pd.read_parquet(f\"{repo}/{path}/training-target.pqt\"),\n    trn_ctx_data=pd.read_parquet(f\"{repo}/{path}/training-context.pqt\"),\n    hol_tgt_data=pd.read_parquet(f\"{repo}/{path}/holdout-target.pqt\"),\n    hol_ctx_data=pd.read_parquet(f\"{repo}/{path}/holdout-context.pqt\"),\n    tgt_context_key=\"id\",\n    ctx_primary_key=\"id\",\n    report_subtitle=\" for Baseball Players\",\n    report_path=\"baseball-players-with-context.html\",\n)\nprint(metrics.model_dump_json(indent=4))\n\nwebbrowser.open(f\"file://{report_path.absolute()}\")\n</code></pre> \ud83d\udc49 HTML Report</p>"},{"location":"examples/#baseball-seasons-sequential-data","title":"Baseball Seasons (Sequential Data)","text":""},{"location":"examples/#case-1-seasons-table-only","title":"Case 1: Seasons Table only","text":"<pre><code>import pandas as pd\nimport webbrowser\nfrom mostlyai.qa import report\n\nrepo = \"https://github.com/mostly-ai/mostlyai-qa\"\npath = \"/raw/refs/heads/main/examples/baseball-seasons\"\n\nreport_path, metrics = report(\n    syn_tgt_data=pd.read_parquet(f\"{repo}/{path}/synthetic-target.pqt\"),\n    trn_tgt_data=pd.read_parquet(f\"{repo}/{path}/training-target.pqt\"),\n    hol_tgt_data=pd.read_parquet(f\"{repo}/{path}/holdout-target.pqt\"),\n    report_subtitle=\" for Baseball Seasons\",\n    report_path=\"baseball-seasons.html\",\n)\nprint(metrics.model_dump_json(indent=4))\n\nwebbrowser.open(f\"file://{report_path.absolute()}\")\n</code></pre> <p>\ud83d\udc49 HTML Report</p>"},{"location":"examples/#case-2-seasons-table-with-context","title":"Case 2: Seasons Table with Context","text":"<pre><code>import pandas as pd\nimport webbrowser\nfrom mostlyai.qa import report\n\nrepo = \"https://github.com/mostly-ai/mostlyai-qa\"\npath = \"/raw/refs/heads/main/examples/baseball-seasons\"\n\nreport_path, metrics = report(\n    syn_tgt_data=pd.read_parquet(f\"{repo}/{path}/synthetic-target.pqt\"),\n    syn_ctx_data=pd.read_parquet(f\"{repo}/{path}/synthetic-context.pqt\"),\n    trn_tgt_data=pd.read_parquet(f\"{repo}/{path}/training-target.pqt\"),\n    trn_ctx_data=pd.read_parquet(f\"{repo}/{path}/training-context.pqt\"),\n    hol_tgt_data=pd.read_parquet(f\"{repo}/{path}/holdout-target.pqt\"),\n    hol_ctx_data=pd.read_parquet(f\"{repo}/{path}/holdout-context.pqt\"),\n    tgt_context_key=\"id\",\n    ctx_primary_key=\"id\",\n    report_subtitle=\" for Baseball Seasons\",\n    report_path=\"baseball-seasons-with-context.html\",\n)\nprint(metrics.model_dump_json(indent=4))\n\nwebbrowser.open(f\"file://{report_path.absolute()}\")\n</code></pre> <p>\ud83d\udc49 HTML Report</p>"},{"location":"metrics/","title":"Metrics Definitions","text":""},{"location":"metrics/#mostlyai.qa.metrics.Metrics","title":"mostlyai.qa.metrics.Metrics","text":"<p>               Bases: <code>CustomBaseModel</code></p> <p>Parameters:</p> Name Type Description Default <code>accuracy</code> <code>Accuracy | None</code> <p>Metrics regarding the accuracy of synthetic data, measured as the closeness of discretized lower dimensional marginal distributions.</p> <code>None</code> <code>similarity</code> <code>Similarity | None</code> <p>Metrics regarding the similarity of the full joint distributions of samples within an embedding space.</p> <code>None</code> <code>distances</code> <code>Distances | None</code> <p>Metrics regarding the nearest neighbor distances between training, holdout, and synthetic samples in an embedding space. Useful for assessing the novelty / privacy of synthetic data.</p> <code>None</code>"},{"location":"metrics/#mostlyai.qa.metrics.Accuracy","title":"mostlyai.qa.metrics.Accuracy","text":"<p>               Bases: <code>CustomBaseModel</code></p> <p>Metrics regarding the accuracy of synthetic data, measured as the closeness of discretized lower dimensional marginal distributions.</p> <ol> <li>Univariate Accuracy: The accuracy of the univariate distributions for all target columns.</li> <li>Bivariate Accuracy: The accuracy of all pair-wise distributions for target columns, as well as for target columns with respect to the context columns.</li> <li>Coherence Accuracy: The accuracy of the auto-correlation for all target columns.</li> </ol> <p>Accuracy is defined as 100% - Total Variation Distance (TVD), whereas TVD is half the sum of the absolute differences of the relative frequencies of the corresponding distributions.</p> <p>These accuracies are calculated for all discretized univariate, and bivariate distributions. In case of sequential data, also for all coherence distributions. Overall metrics are then calculated as the average across these accuracies.</p> <p>All metrics can be compared against a theoretical maximum accuracy, which is calculated for a same-sized holdout. The accuracy metrics shall be as close as possible to the theoretical maximum, but not significantly higher, as this would indicate overfitting.</p> <p>Parameters:</p> Name Type Description Default <code>overall</code> <code>float | None</code> <p>Overall accuracy of synthetic data, averaged across univariate, bivariate, and coherence.</p> <code>None</code> <code>univariate</code> <code>float | None</code> <p>Average accuracy of discretized univariate distributions.</p> <code>None</code> <code>bivariate</code> <code>float | None</code> <p>Average accuracy of discretized bivariate distributions.</p> <code>None</code> <code>coherence</code> <code>float | None</code> <p>Average accuracy of discretized coherence distributions. Only applicable for sequential data.</p> <code>None</code> <code>overall_max</code> <code>float | None</code> <p>Expected overall accuracy of a same-sized holdout. Serves as a reference for <code>overall</code>.</p> <code>None</code> <code>univariate_max</code> <code>float | None</code> <p>Expected univariate accuracy of a same-sized holdout. Serves as a reference for <code>univariate</code>.</p> <code>None</code> <code>bivariate_max</code> <code>float | None</code> <p>Expected bivariate accuracy of a same-sized holdout. Serves as a reference for <code>bivariate</code>.</p> <code>None</code> <code>coherence_max</code> <code>float | None</code> <p>Expected coherence accuracy of a same-sized holdout. Serves as a reference for <code>coherence</code>.</p> <code>None</code>"},{"location":"metrics/#mostlyai.qa.metrics.Similarity","title":"mostlyai.qa.metrics.Similarity","text":"<p>               Bases: <code>CustomBaseModel</code></p> <p>Metrics regarding the similarity of the full joint distributions of samples within an embedding space.</p> <ol> <li>Cosine Similarity: The cosine similarity between the centroids of synthetic and training samples.</li> <li>Discriminator AUC: The AUC of a discriminative model to distinguish between synthetic and training samples.</li> </ol> <p>The SentenceTransformer model all-MiniLM-L6-v2 is used to compute the embeddings of a string-ified representation of individual records. In case of sequential data the records, that belong to the same group, are being concatenated. We then calculate the cosine similarity between the centroids of the provided datasets within the embedding space.</p> <p>Again, we expect the similarity metrics to be as close as possible to 1, but not significantly higher than what is measured for the holdout data, as this would again indicate overfitting.</p> <p>In addition, a discriminative ML model is trained to distinguish between training and synthetic samples. The ability of this model to distinguish between training and synthetic samples is measured by the AUC score. For synthetic data to be considered realistic, the AUC score should be close to 0.5, which indicates that the synthetic data is indistinguishable from the training data.</p> <p>Parameters:</p> Name Type Description Default <code>cosine_similarity_training_synthetic</code> <code>float | None</code> <p>Cosine similarity between training and synthetic centroids.</p> <code>None</code> <code>cosine_similarity_training_holdout</code> <code>float | None</code> <p>Cosine similarity between training and holdout centroids. Serves as a reference for <code>cosine_similarity_training_synthetic</code>.</p> <code>None</code> <code>discriminator_auc_training_synthetic</code> <code>float | None</code> <p>Cross-validated AUC of a discriminative model to distinguish between training and synthetic samples.</p> <code>None</code> <code>discriminator_auc_training_holdout</code> <code>float | None</code> <p>Cross-validated AUC of a discriminative model to distinguish between training and holdout samples. Serves as a reference for <code>discriminator_auc_training_synthetic</code>.</p> <code>None</code>"},{"location":"metrics/#mostlyai.qa.metrics.Distances","title":"mostlyai.qa.metrics.Distances","text":"<p>               Bases: <code>CustomBaseModel</code></p> <p>Metrics regarding the nearest neighbor distances between training, holdout, and synthetic samples in an embedding space. Useful for assessing the novelty / privacy of synthetic data.</p> <p>The provided data is first down-sampled, so that the number of samples match across all datasets. Note, that for an optimal sensitivity of this privacy assessment it is recommended to use a 50/50 split between training and holdout data, and then generate synthetic data of the same size.</p> <p>The embeddings of these samples are then computed, and the L2 nearest neighbor distances are calculated for each synthetic sample to the training and holdout samples. Based on these nearest neighbor distances the following metrics are calculated: - Identical Match Share (IMS): The share of synthetic samples that are identical to a training or holdout sample. - Distance to Closest Record (DCR): The average distance of synthetic to training or holdout samples.</p> <p>For privacy-safe synthetic data we expect to see about as many identical matches, and about the same distances for synthetic samples to training, as we see for synthetic samples to holdout.</p> <p>Parameters:</p> Name Type Description Default <code>ims_training</code> <code>float | None</code> <p>Share of synthetic samples that are identical to a training sample.</p> <code>None</code> <code>ims_holdout</code> <code>float | None</code> <p>Share of synthetic samples that are identical to a holdout sample. Serves as a reference for <code>ims_training</code>.</p> <code>None</code> <code>dcr_training</code> <code>float | None</code> <p>Average L2 nearest-neighbor distance between synthetic and training samples.</p> <code>None</code> <code>dcr_holdout</code> <code>float | None</code> <p>Average L2 nearest-neighbor distance between synthetic and holdout samples. Serves as a reference for <code>dcr_training</code>.</p> <code>None</code> <code>dcr_share</code> <code>float | None</code> <p>Share of synthetic samples that are closer to a training sample than to a holdout sample. This should not be significantly larger than 50%.</p> <code>None</code>"}]}